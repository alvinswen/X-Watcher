# 架构文档

## 概述

SeriousNewsAgent 采用分层架构设计，结合 AI Agent 能力，为科技公司高管提供个性化的智能新闻流。

## 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                         客户端                                │
│                    (Web / CLI / API)                         │
└─────────────────────────┬───────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                      API 层 (FastAPI)                         │
│  ┌────────────┐  ┌────────────┐  ┌──────────────────────┐  │
│  │ CORS 中间件 │  │ 异常处理   │  │    路由              │  │
│  └────────────┘  └────────────┘  └──────────────────────┘  │
└─────────────────────────┬───────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                  Agent 层 (Nanobot)                          │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              意图理解 & 工具调度                       │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────┬───────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                    Tools 层 (工具函数)                        │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────┐  │
│  │ 抓取工具  │ │ 分析工具  │ │ 翻译工具  │ │  偏好管理     │  │
│  │(Twitter) │ │(去重/摘要)│ │(英译中)  │ │              │  │
│  └──────────┘ └──────────┘ └──────────┘ └──────────────┘  │
└─────────────────────────┬───────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                      Data 层                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐  │
│  │   数据库     │  │  MiniMax API │  │   X 平台 API     │  │
│  │ (SQLite/PG)  │  │   (LLM)      │  │  (TwitterAPI.io) │  │
│  └──────────────┘  └──────────────┘  └──────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 数据模型

### User (用户)
- `id`: 主键
- `name`: 用户名
- `email`: 邮箱（唯一）
- `created_at`: 创建时间

### Preference (偏好)
- `id`: 主键
- `user_id`: 用户 ID（外键）
- `key`: 偏好键
- `value`: 偏好值

### NewsItem (新闻)
- `id`: 主键
- `user_id`: 用户 ID（外键）
- `content`: 新闻内容
- `source`: 来源
- `created_at`: 创建时间

## 数据流

```
用户请求
    ↓
API 层接收请求
    ↓
Agent 理解意图
    ↓
调用相应工具
    ↓
工具处理数据
    ↓
结果返回给用户
```

## 部署架构

### 开发环境
- 数据库: SQLite (本地文件)
- LLM: MiniMax M2.1 API
- Web 服务器: Uvicorn 开发模式

### 生产环境 (计划)
- 数据库: PostgreSQL
- LLM: MiniMax M2.1 API
- Web 服务器: Uvicorn + Gunicorn
- 容器化: Docker
- 反向代理: Nginx

## 扩展性设计

### 当前阶段: 单 Agent + 工具函数
- Nanobot 负责意图理解
- 工具函数执行业务逻辑
- 所有功能共享 MiniMax LLM

### 未来阶段: 多 Agent (按需)
当出现以下需求时，考虑拆分：
- 不同功能需要使用不同 LLM（成本优化）
- 某个功能需要独立部署和扩展
- 团队协作需要明确边界

拆分方式：
```
工具函数 (tools/analyzer.py)
    ↓ 拆分为
独立 Agent (agents/analyzer_agent.py)
    + 独立 LLM 配置
    + 独立部署
```

## 安全考虑

- API 密钥通过环境变量配置
- `.env` 文件被 `.gitignore` 排除
- 生产环境 CORS 应限制具体域名
- 敏感信息不记录日志
